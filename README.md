<!-- markdownlint-disable MD033 -->
<!-- markdownlint-disable MD028 -->
<!-- markdownlint-disable MD007 -->
<!-- markdownlint-disable MD045 -->

# Joplin Plugin: Tiles Feed <img src=img/icon_32.png>

Generates a feed of notes displayed as tiles, similar to Google Keep.

<img src=img/main.png> <!-- This image might need updating to show tiles -->
<!-- TOC -->

- [Installation](#installation)
  - [Automatic](#automatic)
  - [Manual](#manual)
    - [Manual via file system](#manual-via-file-system)
    - [Manual via file via GUI](#manual-via-file-via-gui)
- [Usage](#usage)
  - [Default Behavior](#default-behavior)
  - [Note Conversion to HTML](#note-conversion-to-html)
  - [Limitations](#limitations)
- [Codeblock options](#codeblock-options)
  - [search](#search)
    - [search variable date](#search-variable-date)
  - [fields](#fields)
  - [sort](#sort)
  - [limit](#limit)
  - [tile](#tile)
  - [alias](#alias)
  - [datetime](#datetime)
  - [image](#image)
  - [excerpt](#excerpt)
  - [details](#details)
  - [count](#count)
- [Tile View and Color-Coding](#tile-view-and-color-coding)
  - [Tile View Specifics](#tile-view-specifics)
  - [Color-Coding Tiles](#color-coding-tiles)
- [Examples](#examples)
  - [Default Feed (Most Recent Notes)](#default-feed-most-recent-notes)
  - [Search Specific Notes as Tiles](#search-specific-notes-as-tiles)
  - [Tiles with Custom Lengths and Color-Coding](#tiles-with-custom-lengths-and-color-coding)
  - [Collapsible Tile Feed](#collapsible-tile-feed)
- [Plugin options](#plugin-options)
- [Keyboard Shortcuts](#keyboard-shortcuts)
- [FAQ](#faq)
  - [The Tiles Feed is not updated](#the-tiles-feed-is-not-updated)
  - [Error: Nested mappings are not allowed in compact mappings](#error-nested-mappings-are-not-allowed-in-compact-mappings)
  - [Error: Implicit map keys need to be followed by map values](#error-implicit-map-keys-need-to-be-followed-by-map-values)
  - [Error: All collection items must start at the same column](#error-all-collection-items-must-start-at-the-same-column)
  - [Error: e.slice is not a function](#error-eslice-is-not-a-function)
- [Develop](#develop)
  - [Build](#build)
  - [Updating the plugin framework](#updating-the-plugin-framework)
- [Changelog](#changelog)
- [Links](#links)

<!-- /TOC -->

## Installation

### Automatic

- Go to `Tools > Options > Plugins`
- Search for `Tiles Feed` (or the old name "Note overview" if the plugin list hasn't updated yet for this fork)
- Click Install plugin
- Restart Joplin to enable the plugin

### Manual

#### Manual via file system

- Download the latest released JPL package (e.g., `com.konashevich.tilesfeed.jpl`) from its release page.
- Close Joplin
- Copy the downloaded JPL package in your profile `plugins` folder
- Start Joplin

#### Manual via file via GUI

- Download the latest released JPL package.
- Go to `Tools > Options > Plugins`
- Click on the gear wheel and select `Install from file`
- Select the downloaded JPL file
- Restart Joplin

## Usage

Create a note and add a settings block like the one below. The plugin will replace this block with a feed of notes displayed as tiles.

```yml
<!-- tiles-plugin
search: notebook:"Projects" tag:important
fields: image, title, excerpt, tags
sort: updated_time DESC
limit: 20
tile:
  maxTitleLength: 40
  maxSnippetLength: 80
-->
```

Several of these blocks can be included in one note. The content is updated automatically based on your plugin settings, or manually by using the command `Tools > Get/Update Tiles Feed`.

### Default Behavior

If you create a `tiles-plugin` block without specifying any options, or if the `search` option is empty, the plugin will automatically display a feed of the **100 most recently updated notes** as tiles.
The default fields shown for these tiles will be: `image, title, excerpt, tags`.
This default view will also convert the note to HTML.

Example of a minimal block invoking default behavior:
```yml
<!-- tiles-plugin
-->
```

### Note Conversion to HTML

**Important:** Using this plugin will convert the **entire note** containing the `<!-- tiles-plugin ... -->` block into an HTML note (its `markup_language` will be set to `2`).
- This means the note's content will be replaced by the rendered HTML tiles. While you can still edit the note, you will typically be editing the raw HTML generated by the plugin (or using Joplin's WYSIWYG HTML editor if available).
- The settings block (`<!-- tiles-plugin ... -->`) is preserved as an HTML comment at the top of the note body. This allows the plugin to read the settings for future updates.
- If a note contains multiple `tiles-plugin` blocks, the note will still be converted to HTML.

### Limitations

> ⚠ Adding and editing the settings block for the Tiles Feed plugin works best in the **Markdown editor** *before* the initial processing. Once the note is converted to HTML, you'll be editing HTML.

> ⚠ When an HTML note (created by this plugin) is edited, especially with the Rich Text (WYSIWYG) editor, the settings block (which is an HTML comment) might be inadvertently altered or removed. It's best to make changes to the settings by switching to the Markdown editor view, carefully editing the HTML comment, or by copying the settings, creating a new Markdown note, and pasting them there.

> ⚠ The manual refresh (`Tools > Get/Update Tiles Feed`) might not immediately reflect changes in the WYSIWYG editor for an HTML note. Switching to another note and back, or using the Markdown editor view, may be needed.

> With an automatic update, the currently displayed note (if it's the one being updated) is not refreshed in real-time to prevent data loss during editing.

## Codeblock options

Options are specified in YAML format within the `<!-- tiles-plugin ... -->` block. The plugin now *only* generates HTML tile views.

### search

The search filter to find notes for the feed. Uses standard [Joplin search syntax](https://joplinapp.org/help/apps/search#search-filters).
- **Default:** If omitted or empty, searches for all notes (`*`).

```yml
search: type:todo iscompleted:0 notebook:"Work"
```

#### search variable date

Use `{{moments:<FORMAT>}}` for dynamic dates in your search query. Replace `<FORMAT>` with [moment.js formatting options](https://momentjs.com/docs/#/displaying/).
You can manipulate dates with `modify:<MANIPULATION>`, e.g., `{{moments:YYYY-MM-DD modify:-7d}}` for 7 days ago.

| Modification | Key |
| ------------ | --- |
| years        | y   |
| quarters     | Q   |
| months       | M   |
| weeks        | w   |
| days         | d   |
| hours        | h   |
| minutes      | m   |

```yml
search: created:{{moments:YYYYMMDD modify:-30d}}
```

### fields

Comma-separated list of fields to fetch for each note to be displayed in the tiles.
- **Default (if search is omitted or empty):** `image, title, excerpt, tags`
- **Default (if search is specified):** `image, title, excerpt, tags` (The plugin is now tile-focused)

Available Joplin fields can be found in the [API documentation](https://joplinapp.org/api/references/rest_api/#properties).
Virtual fields available:
- `image`: First image from the note.
- `excerpt`: A snippet of the note body.
- `tags`: Comma-separated list of note tags.
- `notebook`: Name of the note's parent notebook.
- `breadcrumb`: Full path of the parent notebook.
- `status` (for ToDos), `file`, `file_size`, `size` are less commonly used in tiles but can be fetched.

```yml
fields: image, title, excerpt, tags, updated_time
```

### sort

Field to sort the notes by, followed by `ASC` (ascending) or `DESC` (descending).
- **Default (if search is omitted or empty):** `updated_time DESC`
- **Default (if search is specified but sort is not):** `updated_time DESC`

```yml
sort: title ASC
```

### limit

Maximum number of notes to display in the feed.
- **Default (if search is omitted or empty and limit is not specified):** `100`
- **Default (if search is specified but limit is not):** No limit (`-1`).

```yml
limit: 15
```

### tile

Options specific to the appearance of individual tiles.
```yml
tile:
  maxTitleLength: 50    # Default: 50. Max characters for tile title before truncation.
  maxSnippetLength: 100 # Default: 100. Max characters for tile snippet before truncation.
```

### alias

This allows renaming fields, primarily for internal data handling if custom field processing were to be added that refers to aliased names. Since tiles have a fixed structure, direct display of aliased field names is not a primary feature for tiles.
Syntax: `<field> AS <new field name>`, multiple fields comma-separated.
```yml
alias: updated_time AS ModifiedDate
```

### datetime

Customize date/time format for fields like `updated_time`, `created_time` if you choose to display them (e.g., by adding them to the `fields` list and customizing tile HTML, though default tiles don't show them).
```yml
datetime:
  date: "YYYY-MM-DD"
  time: "HH:mm"
  humanize:
    enabled: false
    withSuffix: true
```
Formats are from [moment.js](https://momentjs.com/docs/#/displaying/format/).

### image

Controls how the first image from a note is selected for the tile.
```yml
image:
  nr: 1          # Default: 1. Which image to use (1st, 2nd, etc.).
  exactnr: true  # Default: true. If false, uses the last image if the specified `nr` is not found.
```
(Width/height settings are no longer applicable as tile images are styled via CSS).

### excerpt

Controls the generation of the text snippet for tiles.
```yml
excerpt:
  maxlength: 100      # Default: 100 (can also be set by `tile.maxSnippetLength`).
  removenewline: true # Default: true.
  removemd: true      # Default: true.
  # regex: ^Project.*   # Optional: Use a regex to extract the excerpt.
  # regexflags: i       # Optional: Regex flags.
```

### details

Wraps the entire tile feed in a collapsible `<details>` HTML tag.
```yml
details:
  open: false  # Default: false. Whether the section is open by default.
  summary: "{{count}} Recent Notes" # Title for the collapsible section. `{{count}}` is replaced by the number of notes.
```

### count

Displays the total number of notes found, either above or below the tile feed.
```yml
count:
  enable: true
  position: above # Or "below". Default: "below" if enabled.
  text: "Found {{count}} notes." # `{{count}}` is replaced.
```

## Tile View and Color-Coding

### Tile View Specifics

The plugin now exclusively uses a tile-based layout. Key characteristics:
- **Responsive Columns:** Tiles are arranged in multiple columns that adapt to the available width.
- **Content-Driven Height:** Each tile's height adjusts to its content (image, title, snippet, tags).
- **HTML Conversion:** The note containing the `tiles-plugin` block is converted to an HTML note. See [Note Conversion to HTML](#note-conversion-to-html).

### Color-Coding Tiles

Tiles can be visually distinguished using specific tags on your notes:
- **Supported Color Tags:** "Red", "Blue", "Yellow", "Green", "Orange", "Purple", "Black", "White", "Pink", "Brown", "Gray" (or "Grey").
- **Styling:** The tile's border will take the full color, and its background will be a lighter, semi-transparent shade of that color.
- **Priority:** The first recognized color tag on a note determines the tile's color.
- **Readability:** Text and tag colors are automatically adjusted for "White", "Black", "Yellow", and "Pink" tiles to maintain readability.

## Examples

### Default Feed (Most Recent Notes)
This shows the 100 most recently updated notes as tiles. The note containing this block will be converted to HTML.
```yml
<!-- tiles-plugin
-->
```

### Search Specific Notes as Tiles
Show "Project Alpha" notes from the "Work" notebook as tiles. This note will be converted to HTML.
```yml
<!-- tiles-plugin
search: notebook:"Work" title:"Project Alpha"
sort: title ASC
fields: image, title, excerpt
-->
```

### Tiles with Custom Lengths and Color-Coding
Show "Urgent" tasks with shorter titles/snippets. If a task also has a "Red" tag, it will be colored red. This note will be converted to HTML.
```yml
<!-- tiles-plugin
search: tag:Urgent type:todo iscompleted:0
fields: title, excerpt, tags
tile:
  maxTitleLength: 30
  maxSnippetLength: 60
-->
```

### Collapsible Tile Feed
Display a collapsible section of "Idea" notes. This note will be converted to HTML.
```yml
<!-- tiles-plugin
search: tag:Idea
details:
  summary: "Brainstorming Ideas ({{count}})"
  open: true
count:
  enable: false # Count is in summary
-->
```

## Plugin options

Settings for the plugin, accessible at `Tools > Options > Tiles Feed`. (Section name updated)

## Keyboard Shortcuts

Under `Options > Keyboard Shortcuts` you can assign a keyboard shortcut for the following command:
- `Get/Update Tiles Feed` (Command name updated)

## FAQ

### The Tiles Feed is not updated
See the [limitations](#limitations) section. Also, ensure the settings block starts with `<!-- tiles-plugin`.

### Error: Nested mappings are not allowed in compact mappings
This error message occurs when a colon is used in the option value and an space character follows the colon. Just enclose the value of the option in quotes like `alias: "title AS : Title :"`.

### Error: Implicit map keys need to be followed by map values
There is a space missing between the `<option>:` and the value. The option should looks like `<option>: <value>`.

### Error: All collection items must start at the same column
If an option value starts with a `{`, the text must be enclosed by quotes.
For example change `text: {{title}} match` to `text: "{{title}} match"`

### Error: e.slice is not a function
If an option value starts with a `{` and and ends with a `}` the text is interpreted as object. Enclose the value with quotes.
For example change `text: {{title}}` to `text: "{{title}}"`

## Develop

### Build

To build your own version of the plugin, install node.js and run the following command: `npm run dist`

### Updating the plugin framework

To update the plugin framework, run `npm run update`

## Changelog

See [Changelog](CHANGELOG.md) (Will need updating for these major changes)

## Links

- [Joplin - Getting started with plugin development](https://joplinapp.org/api/get_started/plugins/)
- [Joplin - Plugin API reference](https://joplinapp.org/api/references/plugin_api/classes/joplin.html)
- [Joplin - Data API reference](https://joplinapp.org/api/references/rest_api/)
- [Joplin - Plugin examples](https://github.com/laurent22/joplin/tree/dev/packages/app-cli/tests/support/plugins)
